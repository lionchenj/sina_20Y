!function(a){"use strict";var b,c,d=$(document.body),e=[],f=[],g={id:"en",name:"英语"},h={id:"zh",name:"中文"},i=a.MutationObserver||a.WebKitMutationObserver;i&&(c=new i(function(a){(a[0].addedNodes.length||a[0].removedNodes.length)&&console.log("dom change")}));var j={};j.relogin=function(){chrome.runtime.sendMessage({event:"relogin"})},j.finCapture=function(a,b,c){chrome.runtime.sendMessage({event:"finCapture",tabId:a,captureArea:b,pixelRatio:c,fromLan:g.id,toLan:h.id})},j.cancelCapture=function(a){chrome.runtime.sendMessage({event:"cancelCapture",tabId:a})},j.getTranslate=function(a,b){chrome.runtime.sendMessage({event:"getTranslate",tabId:a,str:b,fromLan:g.id,toLan:h.id})},j.finEdit=function(a,b){chrome.runtime.sendMessage({event:"finEdit",tabId:a,imgData:b,fromLan:g.id,toLan:h.id})},chrome.runtime.onMessage.addListener(function(c){var g,h;switch(c.event){case"startCrop":chrome.runtime.sendMessage({event:"startCropRsp",tabId:c.tabId}),b=c.tabId,a.clearOCRTCrop(),a.closeOCRTPanel(),a.clearEditImg(),a.closeOCRTClipboard(),a.beginOCRTCrop(d);break;case"disPanel":e=[],f=[],a.showOCRTPanel(d),a.showOCRTPanelPic(c.imgData),a.showOCRTPanelResultWaiting();break;case"showOCR":try{var i,k=c.ocrData,l="",m="",n=parseInt(k.error_code);if(0===n){for(g=0,h=k.content.length;h>g;g++)i=k.content[g].src.replace(/(^\s*)|(\s*$)/g,""),l+=i,i=k.content[g].dst.replace(/(^\s*)|(\s*$)/g,""),m+=i,k.content[g+1]&&(l+="\n",m+="<br>");a.showOCRTPanelResultOCR(l),a.showOCRTPanelResultTrans(m)}else switch(n){case 1001:case 1004:case 1005:case 1006:a.showOCRTPanelResultWarning("OCR识别错误","服务器异常，请稍后重试，或安装最新版本");break;case 1002:a.showOCRTPanelResultWarning("身份验证失败",'百度账号身份验证失败，请再次点击右上方 <img width="14" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAAXNSR0IArs4c6QAAAY5JREFUOBGtVD1Lw1AUbWLBySGCa+asQisJrq6dxclFRKk49j+4dxDcHHRzUjc3JS3NULdCQLCr0FAc8+U54T155FvwwSXnnXPuzc17l2iu66admqVp2ty27V34rmAb1Vg7XSEukfRWYfwkr+v6PE3T+zIP+H3wZoedTSaTuzJTW475rKO3TWjjk59Z6l0sFltBEHxRNAxjx7Ks71KjIGs7W6/XxzhLnUFcV4habbEkSYbwPDAEZk7lqiw2m80OkGUhxiIswVUX4xxBza5fdcVxPIT2jhl7ZRCTUz0K1oi7HEiFzKDneWYYhgPM1pnUUGyMT72m1uv1lpIXz2zwdU72dDo9UsUois6x30DyDeeHQYyCidBUO3HWGc9shAkeSNX3/U3gE3T1grhUA8UeqQmPTOEz66wwZ6vV6hDiNoqc9vv9DzUDF/CEc/OF51bViAu3ic+5QKfP+UI0k6NGD/f5VejMcZy9vEndQ/89EpUnLnSWN/xl/6/FNF473l73P2tsTv7P5JmZIMzGrAbDD93OsX3UMYqeAAAAAElFTkSuQmCC"> 按钮重新登录'),j.relogin();break;case 1003:a.showOCRTPanelResultWarning("请求过于频繁","每次请求间隔需大于3秒，请稍候再试。");break;case 1007:a.showOCRTPanelResultWarning("今日使用次数达到上限",'每日最多翻译500次。如您有更多翻译需求，可直接戳下面链接进入百度翻译首页拖入或粘贴图片。<a href="https://fanyi.baidu.com" target="_blank">https://fanyi.baidu.com</a>');break;case 4001:a.showOCRTPanelResultWarning("OCR识别错误","图片文字识别失败");break;default:a.showOCRTPanelResultWarning("OCR识别错误",""+k.error_msg)}}catch(o){a.showOCRTPanelResultWarning("OCR错误","数据出现异常")}break;case"showTrans":try{var p=JSON.parse(c.transData);if(p.error_code)a.showOCRTPanelResultWarning("翻译错误",p.error_msg);else{for(g=0,h=p.trans_result.length;h>g;g++){var q=e.indexOf(p.trans_result[g].src);-1!==q&&(f[q]=p.trans_result[g].dst)}a.showOCRTPanelResultTrans(f.join("<br>"))}}catch(o){a.showOCRTPanelResultWarning("翻译错误","数据出现异常")}break;case"showError":a.showOCRTPanelResultWarning("错误",c.errMsg);break;case"showClipboard":b=c.tabId,a.clearOCRTCrop(),a.closeOCRTPanel(),a.clearEditImg(),a.closeOCRTClipboard(),a.showOCRTClipboardImg(d,c.imageSrc)}}),a.finOCRTCrop=function(c){setTimeout(function(){j.finCapture(b,c,a.devicePixelRatio||1)},100)},a.cancelOCRTCrop=function(){j.cancelCapture(b)},a.finEditImg=function(c){a.showOCRTPanelPic(c),a.showOCRTPanelResultWaiting(),j.finEdit(b,c),e=[],f=[]},a.reCapture=function(){chrome.runtime.sendMessage({event:"startCropRsp",tabId:b}),a.clearOCRTCrop(),a.closeOCRTPanel(),a.clearEditImg(),a.closeOCRTClipboard(),a.beginOCRTCrop(d)},a.changePanelText=function(a){e=a,f=[];for(var c=e.length-1;c>=0;c--)j.getTranslate(b,e[c])},a.useClipboard=function(){chrome.runtime.sendMessage({event:"useClipboard",tabId:b,fromLan:g.id,toLan:h.id})},a.getFromLanguage=function(){return g.name},a.getToLanguage=function(){return h.name},a.getFromLanguageId=function(){return g.id},a.getToLanguageId=function(){return h.id},a.toggleFromTo=function(){var a=g;g=h,h=a},a.moreExplain=function(){chrome.runtime.sendMessage({event:"moreExplain"})},a.clearOCRTCrop(),a.closeOCRTPanel(),a.clearEditImg(),a.closeOCRTClipboard()}(window);