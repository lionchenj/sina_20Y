!function(a){"use strict";var b,c,d,e,f,g,h,i,j,k=null,l=null,m='<div class="ocrt-cap-background" id="ocrt_capture"><div class="ocrt-cap-wrap"><div style="width:100%;height:100%;background:transparent;"></div></div></div>',n='<div class="ocrt-cap-btn changelan"><span class="ocrt-cap-from"></span><span class="ocrt-iconfont">&#xe6df;</span><span class="ocrt-cap-to"></span></div><div class="verticalline"></div><div class="ocrt-cap-btn redobtn"><span class="ocrt-iconfont">&#xe638;</span>重试</div><div class="ocrt-cap-btn closebtn"><span class="ocrt-iconfont">&#xe633;</span>取消</div><div class="ocrt-cap-btn recognizebtn"><span class="ocrt-iconfont">&#xe67f;</span>确认</div>';d=function(b){27===b.keyCode&&k&&(h(),"function"==typeof a.cancelOCRTCrop&&a.cancelOCRTCrop())},e=function(a){window.innerHeight-a.y-a.h<35?l.addClass("revertToolbar"):l.removeClass("revertToolbar"),a.x2<350?l.addClass("revertToolbar-h"):l.removeClass("revertToolbar-h"),b={x:a.x,y:a.y,width:a.w,height:a.h}},f=function(){var c;k.getOptions().allowSelect&&(k.setOptions({allowSelect:!1}),c=l.find(".ocrt-cap-toolbar"),c.length<1&&(l.find(".ocrt-cap  > div:first-child").append('<div class="ocrt-cap-toolbar"></div>'),c=l.find(".ocrt-cap-toolbar"),c.html(n)),c.length>0&&c.show(),j(),l.find(".changelan").on("click",function(){i()}),l.find(".redobtn").on("click",function(){k&&(k.setOptions({allowSelect:!0}),k.release()),c.length>0&&c.hide()}),l.find(".closebtn").on("click",function(){h(),"function"==typeof a.cancelOCRTCrop&&a.cancelOCRTCrop()}),l.find(".recognizebtn").on("click",function(){var c={x:b.x,y:b.y,width:b.width,height:b.height};h(),"function"==typeof a.finOCRTCrop&&a.finOCRTCrop(c)}))},g=function(){if(l&&k){k.destroy(),l.find(".ocrt-cap-wrap").html('<div style="width:100%;height:100%;background:transparent;"></div>');var a={addClass:"ocrt-cap",minSize:[1,1],maxSize:[1280,Math.min(1280,window.innerHeight-60)],onChange:e,onSelect:f,setSelect:[]};b?(a.setSelect.push(b.x),a.setSelect.push(b.y),a.setSelect.push(b.x+b.width),a.setSelect.push(b.y+b.height)):(a.setSelect.push(0),a.setSelect.push(0),a.setSelect.push(10),a.setSelect.push(10)),l.find(".ocrt-cap-wrap div").Jcrop(a,function(){k=this,f()}),c=null}},h=function(){k&&(k.destroy(),k=null),l?(l.find(".closebtn").off("click"),l.find(".recognizebtn").off("click"),l.remove(),l=null):$("#ocrt_capture").remove(),b=null,document.removeEventListener("keydown",d,!0),$(window).off("resize")},i=function(){"function"==typeof a.toggleFromTo&&(a.toggleFromTo(),j())},j=function(){l&&(l.find(".ocrt-cap-from").html(a.getFromLanguage()),l.find(".ocrt-cap-to").html(a.getToLanguage()))},a.beginOCRTCrop=function(b){try{l=$("#ocrt_capture"),l.length<1&&(l=$(m),b.append(l)),l.find(".ocrt-cap-wrap div").Jcrop({addClass:"ocrt-cap",minSize:[1,1],maxSize:[1280,Math.min(1280,window.innerHeight-60)],onChange:e,onSelect:f},function(){k=this}),$(window).on("resize",function(){null!==c&&clearTimeout(c),c=setTimeout(g,150)}),document.addEventListener("keydown",d,!0)}catch(i){console.error(i),h(),"function"==typeof a.cancelOCRTCrop&&a.cancelOCRTCrop()}},a.appendOCRTCrop=function(a){l&&a.append(l)},a.checkOCRTCrop=function(){return l&&k&&!document.contains(l[0])},a.clearOCRTCrop=h}(window);